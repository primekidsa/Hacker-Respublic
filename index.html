<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hacker Life OS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- –°–¢–ò–õ–ò –û–°–¢–ê–õ–ò–°–¨ –ü–†–ï–ñ–ù–ò–ú–ò (–ö–†–ê–°–ò–í–´–ú–ò) --- */
        :root {
            --bg-color: #050510;
            --card-bg: rgba(20, 25, 50, 0.9);
            --primary: #00ff9d; 
            --secondary: #00d2ff;
            --danger: #ff3333;
            --warning: #ffd700;
            --text-main: #e0e0ff;
            --text-muted: #8a8aab;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; padding: 0;
            font-family: 'Courier New', monospace;
            background-color: var(--bg-color);
            background-image: 
                linear-gradient(rgba(0, 255, 157, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 157, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .hidden { display: none !important; }
        .text-green { color: var(--primary); }
        .text-blue { color: var(--secondary); }
        .text-red { color: var(--danger); }
        .text-gold { color: var(--warning); }
        
        button { border: none; outline: none; cursor: pointer; font-family: inherit; }

        .header {
            padding: 15px;
            background: rgba(5, 5, 16, 0.95);
            border-bottom: 1px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.1);
            z-index: 10;
        }
        .user-info { font-weight: bold; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .level-badge { background: var(--primary); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 900; }

        .stats-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
            padding: 10px;
            background: rgba(255,255,255,0.02);
        }
        .stat-item {
            background: var(--card-bg);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            font-size: 12px;
        }
        .stat-val { font-size: 14px; font-weight: bold; margin-top: 2px; }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 80px; 
            position: relative;
        }

        .section-title {
            font-size: 18px;
            border-left: 3px solid var(--primary);
            padding-left: 10px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
        }

        .card {
            background: var(--card-bg);
            border: 1px solid rgba(0, 255, 157, 0.15);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }
        .card h3 { margin: 0 0 10px 0; font-size: 16px; color: var(--secondary); }

        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            transition: 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
            text-transform: uppercase;
        }
        .btn-primary { background: rgba(0, 255, 157, 0.1); color: var(--primary); border: 1px solid var(--primary); }
        .btn-primary:active { background: var(--primary); color: #000; }
        .btn-secondary { background: rgba(0, 210, 255, 0.1); color: var(--secondary); border: 1px solid var(--secondary); }
        .btn-secondary:active { background: var(--secondary); color: #000; }
        .btn-danger { background: rgba(255, 51, 51, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        
        .shop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .shop-item {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .shop-icon { font-size: 24px; margin-bottom: 5px; }
        .shop-price { font-size: 12px; color: var(--warning); margin: 5px 0; }

        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: rgba(5, 5, 16, 0.95);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 20;
            backdrop-filter: blur(10px);
        }
        .nav-item {
            color: var(--text-muted);
            font-size: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            width: 20%;
            transition: 0.2s;
        }
        .nav-item i { font-size: 18px; }
        .nav-item.active { color: var(--primary); text-shadow: 0 0 10px var(--primary); }

        @keyframes scanline { 0% { top: -100%; } 100% { top: 100%; } }
        .scanline::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 5px;
            background: rgba(0, 255, 157, 0.3); opacity: 0.4; animation: scanline 4s linear infinite;
        }

        .toast {
            position: fixed; top: 70px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 255, 157, 0.9); color: #000; padding: 8px 16px;
            border-radius: 20px; font-weight: bold; font-size: 12px; z-index: 100;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        
        /* –õ–æ–∞–¥–µ—Ä */
        #loader {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: var(--bg-color); z-index: 999;
            display: flex; justify-content: center; align-items: center;
            color: var(--primary); font-size: 20px;
        }
    </style>
</head>
<body class="scanline">

    <div id="loader">CONNECTING TO MAINFRAME...</div>

    <header class="header">
        <div class="user-info">
            <span class="level-badge">LVL <span id="lvl-val">1</span></span>
            <span id="username">Hacker</span>
        </div>
        <div id="save-status" style="font-size: 10px; opacity: 0.5;">SYNCED</div>
    </header>

    <div class="stats-bar">
        <div class="stat-item text-gold">
            <i class="fa-solid fa-dollar-sign"></i>
            <div class="stat-val" id="money-val">0</div>
        </div>
        <div class="stat-item text-green">
            <i class="fa-solid fa-bolt"></i>
            <div class="stat-val"><span id="energy-val">0</span>%</div>
        </div>
        <div class="stat-item text-blue">
            <i class="fa-brands fa-bitcoin"></i>
            <div class="stat-val" id="btc-val">0.000</div>
        </div>
    </div>

    <div class="content">
        
        <div id="screen-home" class="screen">
            <div class="card" style="text-align: center;">
                <div style="font-size: 50px; color: var(--primary); margin-bottom: 10px;">
                    <i class="fa-solid fa-user-secret"></i>
                </div>
                <h3>–°–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ç—É—Å</h3>
                <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 12px;">
                    <div>üíª –°–µ—Ä–≤–µ—Ä—ã: <span id="servers-val" class="text-green">0</span></div>
                    <div>‚õè –ú–∞–π–Ω–µ—Ä—ã: <span id="miners-val" class="text-blue">0</span></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 12px;">
                    <div>üõ° –ó–∞—â–∏—Ç–∞: <span id="def-val" class="text-green">0</span></div>
                    <div>‚öî –ù–∞–≤—ã–∫: <span id="skill-val" class="text-red">1</span></div>
                </div>
            </div>

            <div class="section-title">–ê–ø–≥—Ä–µ–π–¥—ã</div>
            <div class="card">
                <h3><i class="fa-solid fa-server"></i> –°–µ—Ä–≤–µ—Ä</h3>
                <p style="font-size: 11px; color: var(--text-muted);">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥: +0.5$/—Å–µ–∫</p>
                <button class="btn btn-secondary" onclick="buyUpgrade('server')">
                    –ö—É–ø–∏—Ç—å (<span id="price-server">100</span>$)
                </button>
            </div>
            <div class="card">
                <h3><i class="fa-brands fa-bitcoin"></i> ASIC Miner</h3>
                <p style="font-size: 11px; color: var(--text-muted);">–ú–∞–π–Ω–∏—Ç BTC</p>
                <button class="btn btn-secondary" onclick="buyUpgrade('miner')">
                    –ö—É–ø–∏—Ç—å (<span id="price-miner">2000</span>$)
                </button>
            </div>
            <div class="card">
                <h3><i class="fa-solid fa-shield-halved"></i> Firewall</h3>
                <p style="font-size: 11px; color: var(--text-muted);">–ó–∞—â–∏—Ç–∞ –æ—Ç PvP</p>
                <button class="btn btn-secondary" onclick="buyUpgrade('firewall')">
                    –ö—É–ø–∏—Ç—å (<span id="price-firewall">500</span>$)
                </button>
            </div>
        </div>

        <div id="screen-work" class="screen hidden">
            <div class="section-title">–¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞</div>
            
            <div id="no-project-view">
                <div class="card" style="text-align: center; padding: 30px;">
                    <i class="fa-solid fa-mug-hot" style="font-size: 40px; color: var(--text-muted); margin-bottom: 10px;"></i>
                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</p>
                    <p style="font-size: 12px; color: gray;">–í–æ–∑—å–º–∏—Ç–µ –∑–∞–∫–∞–∑ –≤ –º–µ–Ω—é –±–æ—Ç–∞ "–†–∞–±–æ—Ç–∞"</p>
                    <button class="btn btn-secondary" onclick="tg.close()">
                        –í –ë–û–¢–ê
                    </button>
                </div>
            </div>

            <div id="active-project-view" class="hidden">
                <div class="card">
                    <h3 id="project-name">–ü—Ä–æ–µ–∫—Ç</h3>
                    <div class="progress-container">
                        <div class="progress-fill" id="project-bar" style="width: 0%"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px;">
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="project-progress">0</span>/<span id="project-goal">100</span></span>
                        <span class="text-gold">–ù–∞–≥—Ä–∞–¥–∞: <span id="project-reward">0</span>$</span>
                    </div>
                    <button class="btn btn-primary" id="btn-code" onclick="doWork()">
                        <i class="fa-solid fa-code"></i> –ü–ò–°–ê–¢–¨ –ö–û–î (-5 ‚ö°)
                    </button>
                </div>
            </div>
        </div>

        <div id="screen-pvp" class="screen hidden">
            <div class="section-title">DarkNet Access</div>
            
            <div id="hack-search-view">
                <div class="card">
                    <h3>–ü–æ–∏—Å–∫ —Ü–µ–ª–∏</h3>
                    <p style="font-size: 12px; color: var(--text-muted);">–¢—Ä–µ–±—É–µ—Ç—Å—è 30 —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–µ—Ç–∏.</p>
                    <button class="btn btn-danger" onclick="pvpScan()">
                        <i class="fa-solid fa-radar"></i> –°–ö–ê–ù–ò–†–û–í–ê–¢–¨ (-30 ‚ö°)
                    </button>
                </div>
            </div>

            <div id="hack-process-view" class="hidden">
                <div class="card" style="border-color: var(--danger);">
                    <h3 class="text-red"><i class="fa-solid fa-crosshairs"></i> –¶–µ–ª—å: <span id="victim-name">...</span></h3>
                    <div class="progress-container">
                        <div class="progress-fill" id="hack-bar" style="width: 0%; background: var(--danger); box-shadow: 0 0 10px var(--danger);"></div>
                    </div>
                    <p style="text-align: center; font-size: 12px;">Brute Force Attack...</p>
                    <button class="btn btn-danger" onclick="pvpAttack()">
                        <i class="fa-solid fa-skull"></i> –í–ó–õ–û–ú–ê–¢–¨
                    </button>
                </div>
            </div>
            
            <div id="hack-win-view" class="hidden">
                <div class="card">
                    <h3 class="text-green">–í–∑–ª–æ–º —É—Å–ø–µ—à–µ–Ω!</h3>
                    <p>–î–æ—Å—Ç—É–ø –ø–æ–ª—É—á–µ–Ω. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞, —á—Ç–æ–±—ã –∑–∞–±—Ä–∞—Ç—å –¥–æ–±—ã—á—É.</p>
                    <button class="btn btn-primary" onclick="tg.close()">–í –ë–û–¢–ê</button>
                </div>
            </div>
        </div>

        <div id="screen-bank" class="screen hidden">
            <div class="section-title">–§–∏–Ω–∞–Ω—Å—ã</div>
            <div class="card">
                <h3><i class="fa-solid fa-building-columns"></i> –û—Ñ—Ñ—à–æ—Ä–Ω—ã–π –ë–∞–Ω–∫</h3>
                <p class="text-muted" style="font-size: 11px;">–ë–∞–ª–∞–Ω—Å: <span id="bank-balance" class="text-gold">0</span>$</p>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="bank-input" placeholder="–°—É–º–º–∞" style="width: 60%; background: #000; border: 1px solid #333; color: #fff; padding: 5px; border-radius: 5px;">
                    <button class="btn btn-primary" style="margin:0; width: 40%; font-size: 10px;" onclick="bankAction('dep')">–í–Ω–µ—Å—Ç–∏</button>
                </div>
                <button class="btn btn-secondary" style="margin-top: 5px; font-size: 10px;" onclick="bankAction('with')">–°–Ω—è—Ç—å</button>
            </div>
        </div>

        <div id="screen-shop" class="screen hidden">
            <div class="section-title">–ß–µ—Ä–Ω—ã–π —Ä—ã–Ω–æ–∫</div>
            <div class="shop-grid">
                <div class="shop-item" onclick="buyItem('coffee')">
                    <div class="shop-icon">‚òï</div>
                    <div>–ö–æ—Ñ–µ</div>
                    <div class="shop-price">40$ (+30‚ö°)</div>
                </div>
                <div class="shop-item" onclick="buyItem('sandwich')">
                    <div class="shop-icon">ü•™</div>
                    <div>–°—ç–Ω–¥–≤–∏—á</div>
                    <div class="shop-price">90$ (+60‚ö°)</div>
                </div>
                <div class="shop-item" onclick="buyItem('pizza')">
                    <div class="shop-icon">üçï</div>
                    <div>–ü–∏—Ü—Ü–∞</div>
                    <div class="shop-price">200$ (+100‚ö°)</div>
                </div>
                <div class="shop-item" onclick="buyItem('energy_drink')">
                    <div class="shop-icon">‚ö°</div>
                    <div>–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫</div>
                    <div class="shop-price">150$ (+80‚ö°)</div>
                </div>
            </div>
            
            <div class="section-title" style="margin-top: 20px;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            <div id="inventory-list" class="shop-grid">
                </div>
        </div>

    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)">
            <i class="fa-solid fa-house"></i>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        <div class="nav-item" onclick="switchTab('work', this)">
            <i class="fa-solid fa-terminal"></i>
            <span>–†–∞–±–æ—Ç–∞</span>
        </div>
        <div class="nav-item" onclick="switchTab('pvp', this)">
            <i class="fa-solid fa-mask"></i>
            <span>–í–∑–ª–æ–º</span>
        </div>
        <div class="nav-item" onclick="switchTab('bank', this)">
            <i class="fa-solid fa-wallet"></i>
            <span>–§–∏–Ω–∞–Ω—Å—ã</span>
        </div>
        <div class="nav-item" onclick="switchTab('shop', this)">
            <i class="fa-solid fa-cart-shopping"></i>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </div>
    </nav>

    <div id="toast" class="toast">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // ----------------------------------------------------
        // !!!!!!!! –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–ô URL –û–¢ NGROK !!!!!!!!
        // –ü—Ä–∏–º–µ—Ä: const API_BASE_URL = "https://a1b2-95-100-200-50.ngrok-free.app";
        const API_BASE_URL = "https://–í–ê–®-–°–°–´–õ–ö–ê-–¢–£–¢.ngrok-free.app"; 
        // ----------------------------------------------------

        let userId = 0;
        // –î–ª—è —Ç–µ—Å—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–µ—Å–ª–∏ –Ω–µ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º)
        if (!tg.initDataUnsafe?.user) {
            userId = 423940119; // –¢–≤–æ–π ID –∏–∑ players_db.json –¥–ª—è —Ç–µ—Å—Ç–∞
        } else {
            userId = tg.initDataUnsafe.user.id;
        }

        async function apiCall(endpoint, data = {}) {
            document.getElementById('save-status').innerText = "SYNCING...";
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, data: data })
                });
                const res = await response.json();
                document.getElementById('save-status').innerText = "ONLINE";
                return res;
            } catch (error) {
                console.error(error);
                document.getElementById('save-status').innerText = "OFFLINE";
                showToast("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", true);
                return null;
            }
        }

        async function init() {
            if (tg.initDataUnsafe?.user) {
                document.getElementById('username').innerText = tg.initDataUnsafe.user.first_name;
            }
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            const res = await apiCall('/get_data');
            if (res) updateUI(res);
            document.getElementById('loader').classList.add('hidden');
        }

        // --- UI UPDATE ---
        function updateUI(player) {
            // Stats
            document.getElementById('money-val').innerText = Math.floor(player.money);
            document.getElementById('energy-val').innerText = Math.floor(player.energy);
            document.getElementById('btc-val').innerText = player.btc.toFixed(4);
            document.getElementById('lvl-val').innerText = player.hacking_skill;

            // Home Stats
            document.getElementById('servers-val').innerText = player.servers;
            document.getElementById('miners-val').innerText = player.miners;
            document.getElementById('def-val').innerText = player.protection;
            document.getElementById('skill-val').innerText = player.hacking_skill;
            
            // Prices
            document.getElementById('price-server').innerText = 100 + (player.servers * 80);
            document.getElementById('price-firewall').innerText = 500 * Math.pow(2, player.protection);
            document.getElementById('price-miner').innerText = 2000 + (player.miners * 1000);

            // Bank
            document.getElementById('bank-balance').innerText = Math.floor(player.bank_balance);

            // Project
            const noProj = document.getElementById('no-project-view');
            const hasProj = document.getElementById('active-project-view');
            
            if (player.current_project) {
                noProj.classList.add('hidden');
                hasProj.classList.remove('hidden');
                document.getElementById('project-name').innerText = player.current_project.name;
                document.getElementById('project-progress').innerText = Math.floor(player.current_project.progress);
                document.getElementById('project-goal').innerText = player.current_project.goal;
                document.getElementById('project-reward').innerText = player.current_project.reward;
                
                let pct = (player.current_project.progress / player.current_project.goal) * 100;
                document.getElementById('project-bar').style.width = pct + "%";
            } else {
                noProj.classList.remove('hidden');
                hasProj.classList.add('hidden');
            }

            // PvP Status
            const searchView = document.getElementById('hack-search-view');
            const hackView = document.getElementById('hack-process-view');
            const winView = document.getElementById('hack-win-view');

            searchView.classList.add('hidden');
            hackView.classList.add('hidden');
            winView.classList.add('hidden');

            if (player.hack_ready_to_loot) {
                winView.classList.remove('hidden');
            } else if (player.active_hack) {
                hackView.classList.remove('hidden');
                document.getElementById('victim-name').innerText = player.active_hack.victim_name;
                let pct = (player.active_hack.progress / player.active_hack.goal) * 100;
                document.getElementById('hack-bar').style.width = pct + "%";
            } else {
                searchView.classList.remove('hidden');
            }

            // Inventory
            const invList = document.getElementById('inventory-list');
            invList.innerHTML = '';
            if (Object.keys(player.inventory).length === 0) {
                invList.innerHTML = '<div style="grid-column: span 2; text-align: center; color: gray;">–ü—É—Å—Ç–æ</div>';
            } else {
                for (const [key, count] of Object.entries(player.inventory)) {
                    // –ü—Ä–æ—Å—Ç–æ–π –º–∞–ø–ø–∏–Ω–≥ –∏–∫–æ–Ω–æ–∫
                    let icon = "üì¶";
                    if(key === 'coffee') icon = "‚òï";
                    if(key === 'sandwich') icon = "ü•™";
                    if(key === 'pizza') icon = "üçï";
                    if(key === 'energy_drink') icon = "‚ö°";
                    
                    let div = document.createElement('div');
                    div.className = 'shop-item';
                    div.innerHTML = `<div class="shop-icon">${icon}</div><div>${key} x${count}</div>`;
                    div.onclick = () => useItem(key);
                    invList.appendChild(div);
                }
            }
        }

        // --- ACTIONS ---

        async function doWork() {
            tg.HapticFeedback.impactOccurred('medium');
            const res = await apiCall('/action/work');
            if(res) {
                updateUI(res.player);
                if(res.success) showToast(res.msg);
                else showToast(res.msg, true);
            }
        }

        async function buyItem(item) {
            tg.HapticFeedback.impactOccurred('light');
            const res = await apiCall('/action/buy', { item: item });
            if(res) {
                updateUI(res.player);
                showToast(res.msg, !res.success);
            }
        }

        async function useItem(item) {
            tg.HapticFeedback.impactOccurred('light');
            const res = await apiCall('/action/use', { item: item });
            if(res) {
                updateUI(res.player);
                showToast(res.msg, !res.success);
            }
        }

        async function buyUpgrade(type) {
            tg.HapticFeedback.impactOccurred('medium');
            const res = await apiCall('/action/upgrade', { type: type });
            if(res) {
                updateUI(res.player);
                showToast(res.msg, !res.success);
            }
        }

        async function bankAction(action) {
            let val = document.getElementById('bank-input').value;
            if (!val) return;
            const res = await apiCall('/action/bank', { action: action, amount: val });
            if(res) {
                updateUI(res.player);
                showToast(res.success ? "–£—Å–ø–µ—à–Ω–æ" : "–û—à–∏–±–∫–∞", !res.success);
            }
        }

        async function pvpScan() {
            const res = await apiCall('/action/pvp_scan');
            if(res) {
                if(res.player) updateUI(res.player);
                if(!res.success) showToast(res.msg, true);
            }
        }

        async function pvpAttack() {
            const res = await apiCall('/action/pvp_attack');
            if(res) {
                updateUI(res.player);
                if(res.res === "FAIL") showToast(res.msg, true);
            }
        }

        // --- UTILS ---
        function switchTab(screenName, navEl) {
            document.querySelectorAll('.screen').forEach(el => el.classList.add('hidden'));
            document.getElementById(`screen-${screenName}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            navEl.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        function showToast(msg, isError=false) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.background = isError ? 'rgba(255, 51, 51, 0.9)' : 'rgba(0, 255, 157, 0.9)';
            t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        }

        // Start
        init();
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥)
        setInterval(async () => {
            const res = await apiCall('/get_data');
            if(res) updateUI(res);
        }, 5000);

    </script>
</body>
</html>
